<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart - Ecommerce</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <!-- header -->
    <section id="header">
        <a href="#"><img src="img/logo.png" alt="logo" /></a>
        <div>
            <ul id="navbar">
                <li class="close-btn" style="display:none;">
                    <i class="fas fa-times"></i>
                </li>
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">shop</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">contact</a></li>
                <li>
                    <a class="active" href="cart.html"><i class="fa-brands fa-shopify"></i></a>
                </li>
            </ul>
        </div>

        <div id="mobile">
            <a href="cart.html"><i class="fa-brands fa-shopify"></i></a>
            <i id="bar" class="fas fa-outdent"></i>
        </div>
    </section>

    <!-- page header -->
    <section id="page-header">
        <h2>Your Cart</h2>
        <p>Review items, update quantities, and proceed to checkout.</p>
    </section>

    <!-- cart content -->
    <main class="section-p1">
        <section id="cart" class="section-p1" style="padding-top:18px;">
            <div style="max-width:1100px; margin:0 auto;">

                <!-- cart table -->
                <div id="cartContainer">
                    <table id="cartTable" style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background:#f5f5f5;">
                                <th style="text-align:left; padding:12px;">Product</th>
                                <th style="padding:12px; text-align:center;">Price</th>
                                <th style="padding:12px; text-align:center;">Qty</th>
                                <th style="padding:12px; text-align:center;">Subtotal</th>
                                <th style="padding:12px; text-align:center;">Remove</th>
                            </tr>
                        </thead>
                        <tbody id="cartBody">
                            <!-- items injected by JavaScript -->
                        </tbody>
                    </table>

                    <!-- empty cart fallback -->
                    <div id="emptyCart" style="display:none;  padding:40px 0; display: flex;">
                        <p><a href="shop.html"
                                style="text-decoration:none; background:#088178; color:#fff; padding:10px 16px; border-radius:6px;">Go
                                to shop</a></p>
                        <H3 style="margin-top: 40px;">Nothing To Show</H3>
                    </div>
                </div>

                <!-- totals and actions -->
                <div style="display:flex; justify-content:flex-end; gap:20px; margin-top:18px; flex-wrap:wrap;">
                    <div
                        style="min-width:260px; border:1px solid #e6e6e6; padding:18px; border-radius:8px; background:#fff;">
                        <h4 style="margin-bottom:12px;">Order Summary</h4>
                        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                            <span>Subtotal</span>
                            <span id="subtotal">$0.00</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                            <span>Shipping</span>
                            <span id="shipping">Free</span>
                        </div>
                        <div
                            style="display:flex; justify-content:space-between; font-weight:700; margin-top:10px; border-top:1px dashed #ddd; padding-top:10px;">
                            <span>Total</span>
                            <span id="total">$0.00</span>
                        </div>

                        <div style="display:flex; gap:10px; margin-top:16px;">
                            <button id="checkoutBtn" class="normal" style="flex:1;">Proceed to Checkout</button>
                            <button id="clearBtn"
                                style="flex:1; background:transparent; border:1px solid #088178; color:#088178; border-radius:6px;">Clear</button>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <!-- newsletter -->
    <section id="newsletter" class="section-p1">
        <div class="newstxt">
            <h4>Sign Up For Newsletters</h4>
            <p>Get email updates about our latest shop and <span>special offers</span></p>
        </div>

        <div class="form">
            <input type="text" placeholder="Your email-address">
            <button class="normal">Signup</button>
        </div>
    </section>

    <!-- footer -->
    <footer class="section-p1">
        <div class="col">
            <img class="logo" src="img/logo.png" alt="">
            <h4>Contact</h4>
            <p><strong>Address</strong>: Lorem ipsum dolor sit amet consectetur adipisicing.</p>
            <p><strong>Phone</strong>: Lorem, ipsum dolor sit amet consectetur adipisicing.</p>
            <p><strong>Hours</strong>: Lorem ipsum dolor sit amet.</p>
            <div class="follow">
                <h4>Follow us</h4>
                <div class="icon">
                    <i class="fab fa-facebook-f"></i>
                    <i class="fab fa-twitter"></i>
                    <i class="fab fa-instagram"></i>
                    <i class="fab fa-pinterest-p"></i>
                    <i class="fab fa-youtube"></i>
                </div>
            </div>
        </div>

        <div class="col">
            <h4>About</h4>
            <a href="#">About us</a>
            <a href="#">Delivery Information</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms & Conditions</a>
            <a href="#">Contact us</a>
        </div>

        <div class="col">
            <h4>My Account</h4>
            <a href="#">Sign In</a>
            <a href="#">View Cart</a>
            <a href="#">My Wishlist</a>
            <a href="#">Track My Order</a>
            <a href="#">Help</a>
        </div>

        <div class="col install">
            <h4>Install App</h4>
            <p>From App Store or Google Play</p>
            <div class="row">
                <img src="img/pay/app.jpg" alt="">
                <img src="img/pay/play.jpg" alt="">
            </div>
            <p>Secured Payment Gateways</p>
            <img src="img/pay/pay.png" alt="">
        </div>

        <div class="copyright">
            <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Mollitia, non.</p>
        </div>
    </footer>

    <script src="https://kit.fontawesome.com/9cf067a3a0.js" crossorigin="anonymous"></script>
    <script src="script.js"></script>

    <!-- cart behavior (wrapped & namespaced to avoid conflicts) -->
    <script>
        (function () {
            'use strict';

            document.addEventListener('DOMContentLoaded', () => {
                const CART_KEY = 'site_cart_v1';

                const demoItems = [
                    { id: 'f1', title: "Cartoon Astronaut T-Shirt", price: 78.00, qty: 1, img: "img/products/f1.jpg" },
                    { id: 'n1', title: "Summer Tee", price: 49.00, qty: 2, img: "img/products/n1.jpg" }
                ];

                function log(...args) { console.info('[cart]', ...args); }

                function fmt(v) { return '$' + v.toFixed(2); }

                function getRaw() {
                    try {
                        return localStorage.getItem(CART_KEY);
                    } catch (e) {
                        console.error('[cart] localStorage read failed', e);
                        return null;
                    }
                }

                function parseCart(raw) {
                    if (!raw) return null;
                    try {
                        return JSON.parse(raw);
                    } catch (e) {
                        console.warn('[cart] JSON parse error, clearing key', e);
                        // clear invalid data
                        try { localStorage.removeItem(CART_KEY); } catch (er) { /* ignore */ }
                        return null;
                    }
                }

                function loadCart() {
                    const raw = getRaw();
                    const parsed = parseCart(raw);
                    if (parsed && Array.isArray(parsed)) return parsed;
                    // initialize demo only when nothing valid exists
                    try {
                        localStorage.setItem(CART_KEY, JSON.stringify(demoItems));
                        log('Initialized demo cart (site_cart_v1).');
                    } catch (e) {
                        console.error('[cart] localStorage write failed', e);
                    }
                    return demoItems.slice();
                }

                function saveCart(cart) {
                    try {
                        localStorage.setItem(CART_KEY, JSON.stringify(cart));
                        log('Cart saved. Items:', cart.length);
                    } catch (e) {
                        console.error('[cart] Save failed', e);
                    }
                }

                // DOM helpers (guarding missing nodes)
                const cartBody = document.getElementById('cartBody');
                const emptyCartEl = document.getElementById('emptyCart');
                const cartTable = document.getElementById('cartTable');
                const subtotalEl = document.getElementById('subtotal');
                const totalEl = document.getElementById('total');
                const shippingEl = document.getElementById('shipping');
                const checkoutBtn = document.getElementById('checkoutBtn');
                const clearBtn = document.getElementById('clearBtn');

                if (!cartBody || !emptyCartEl || !cartTable) {
                    console.error('[cart] Required DOM elements missing. Aborting render.');
                    return;
                }

                function updateTotals() {
                    const cart = loadCart();
                    const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0);
                    const shipping = 0;
                    const total = subtotal + shipping;
                    if (subtotalEl) subtotalEl.textContent = fmt(subtotal);
                    if (totalEl) totalEl.textContent = fmt(total);
                    if (shippingEl) shippingEl.textContent = shipping ? fmt(shipping) : 'Free';
                }

                function attachCartListeners() {
                    // qty inputs
                    document.querySelectorAll('.qtyInput').forEach(input => {
                        input.removeEventListener('change', input._cartChange || (() => { }));
                        const handler = (e) => {
                            const id = e.target.dataset.id;
                            let val = parseInt(e.target.value, 10);
                            if (isNaN(val) || val < 1) val = 1;
                            updateQty(id, val);
                        };
                        input.addEventListener('change', handler);
                        input._cartChange = handler;
                    });

                    // remove buttons
                    document.querySelectorAll('.removeBtn').forEach(btn => {
                        btn.removeEventListener('click', btn._cartRemove || (() => { }));
                        const handler = (e) => {
                            const id = e.target.dataset.id;
                            removeItem(id);
                        };
                        btn.addEventListener('click', handler);
                        btn._cartRemove = handler;
                    });
                }

                function renderCart() {
                    const cart = loadCart() || [];
                    cartBody.innerHTML = '';

                    if (!cart.length) {
                        if (cartTable) cartTable.style.display = 'none';
                        emptyCartEl.style.display = 'block';
                        updateTotals();
                        return;
                    }

                    if (cartTable) cartTable.style.display = '';
                    emptyCartEl.style.display = 'none';

                    cart.forEach(item => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
              <td style="padding:12px; vertical-align:middle;">
                <div style="display:flex; gap:12px; align-items:center;">
                  <img src="${item.img}" alt="${item.title}" style="width:80px; height:80px; object-fit:cover; border-radius:8px;">
                  <div>
                    <div style="font-weight:700;">${item.title}</div>
                    <div style="color:rgb(132,124,124); font-size:13px;">SKU: ${item.id}</div>
                  </div>
                </div>
              </td>
              <td style="padding:12px; text-align:center; vertical-align:middle;">${fmt(item.price)}</td>
              <td style="padding:12px; text-align:center; vertical-align:middle;">
                <input data-id="${item.id}" class="qtyInput" type="number" min="1" value="${item.qty}" style="width:60px; padding:6px; border-radius:6px; border:1px solid #ccc;">
              </td>
              <td style="padding:12px; text-align:center; vertical-align:middle;">${fmt(item.price * item.qty)}</td>
              <td style="padding:12px; text-align:center; vertical-align:middle;">
                <button data-id="${item.id}" class="removeBtn" style="background:transparent; border:none; color:crimson; cursor:pointer;">Remove</button>
              </td>
            `;
                        cartBody.appendChild(tr);
                    });

                    attachCartListeners();
                    updateTotals();
                }

                function updateQty(id, qty) {
                    const cart = loadCart();
                    const idx = cart.findIndex(i => i.id === id);
                    if (idx === -1) return;
                    cart[idx].qty = qty;
                    saveCart(cart);
                    renderCart();
                }

                function removeItem(id) {
                    let cart = loadCart();
                    cart = cart.filter(i => i.id !== id);
                    saveCart(cart);
                    renderCart();
                }

                function clearCart() {
                    try {
                        localStorage.removeItem(CART_KEY);
                        log('Cleared cart key from localStorage.');
                    } catch (e) {
                        console.error('[cart] Failed clearing localStorage', e);
                    }
                    renderCart();
                }

                function checkout() {
                    const cart = loadCart();
                    if (!cart.length) {
                        alert('Your cart is empty.');
                        return;
                    }
                    alert('Proceeding to checkout. (Demo)');
                }

                // wire UI buttons safely
                if (checkoutBtn) checkoutBtn.addEventListener('click', checkout);
                if (clearBtn) clearBtn.addEventListener('click', () => {
                    if (confirm('Clear cart?')) clearCart();
                });

                // expose a small debug function to console
                window.__debugCart = () => {
                    console.log('site_cart_v1:', parseCart(getRaw()));
                };

                // initial render
                log('Rendering cart...');
                renderCart();
            }); // DOMContentLoaded
        })();
    </script>

    <style>
        /* Small cart-specific tweaks to work with your existing style.css */
        @media (max-width: 900px) {
            #cartTable thead {
                display: none;
            }

            #cartTable,
            #cartTable tbody,
            #cartTable tr,
            #cartTable td {
                display: block;
                width: 100%;
            }

            #cartTable tr {
                margin-bottom: 12px;
                border: 1px solid #eee;
                padding: 10px;
                border-radius: 8px;
            }

            #cartTable td {
                padding: 8px 6px;
                text-align: left;
            }

            #cartTable td:nth-child(4) {
                font-weight: 700;
            }

            #cartTable td img {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</body>

</html>

</html>